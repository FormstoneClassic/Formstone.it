/* 
 * Zoomer v3.0.3 - 2014-02-17 
 * A jQuery plugin for smooth image exploration. Part of the formstone library. 
 * http://formstone.it/components/zoomer/ 
 * 
 * Copyright 2014 Ben Plum; MIT Licensed 
 */ 

!function(a,b){"use strict";function c(b){for(var c=a.extend({},F,G,b),e=a(this),f=0,g=e.length;g>f;f++)d.apply(e.eq(f),[a.extend({},c)]);return D=a(".zoomer-element"),A(),e}function d(b){b.$target=a(this),b.marginReal=2*b.marginMin,b.originalDOM=b.$target.html(),b.$target.find("img").length>0&&(b.source=[],b.$target.find("img").each(function(){b.source.push(a(this).attr("src"))}),b.$target.empty()),b=z(b);var c='<div class="zoomer '+b.customClass+'">';c+='<div class="zoomer-positioner">',c+='<div class="zoomer-holder">',c+="</div>",c+="</div>",c+="</div>",b.$zoomer=a(c),b.$target.addClass("zoomer-element").html(b.$zoomer),b.controls.zoomIn||b.controls.zoomOut||b.controls.next||b.controls.previous?(b.controls.$zoomIn=a(b.controls.zoomIn),b.controls.$zoomOut=a(b.controls.zoomOut),b.controls.$next=a(b.controls.next),b.controls.$previous=a(b.controls.previous)):(c='<div class="zoomer-controls zoomer-controls-'+b.controls.position+'">',c+='<span class="zoomer-previous">&lsaquo;</span>',c+='<span class="zoomer-zoom-out">-</span>',c+='<span class="zoomer-zoom-in">+</span>',c+='<span class="zoomer-next">&rsaquo;</span>',c+="</div>",b.$zoomer.append(c),b.controls.$default=b.$zoomer.find(".zoomer-controls"),b.controls.$zoomIn=b.$zoomer.find(".zoomer-zoom-in"),b.controls.$zoomOut=b.$zoomer.find(".zoomer-zoom-out"),b.controls.$next=b.$zoomer.find(".zoomer-next"),b.controls.$previous=b.$zoomer.find(".zoomer-previous")),b.$positioner=b.$zoomer.find(".zoomer-positioner"),b.$holder=b.$zoomer.find(".zoomer-holder"),b.controls.$zoomIn.on("touchstart.zoomer mousedown.zoomer",b,n).on("touchend.zoomer mouseup.zoomer",b,p),b.controls.$zoomOut.on("touchstart.zoomer mousedown.zoomer",b,o).on("touchend.zoomer mouseup.zoomer",b,p),b.controls.$next.on("click.zoomer",b,l),b.controls.$previous.on("click.zoomer",b,m),b.$zoomer.on("mousedown.zoomer",b,s).on("touchstart.zoomer MSPointerDown.zoomer",":not(.zoomer-controls)",b,v),b.$target.data("zoomer",b),H.resize.apply(b.$target),b.images.length>0&&e.apply(b.$target,[b])}function e(a){a.gallery?a.$zoomer.addClass("zoomer-gallery"):a.$zoomer.removeClass("zoomer-gallery"),"undefined"!=typeof a.$image?a.$holder.animate({opacity:0},300,function(){H.unload.apply(a.$target),f.apply(a.$target,[a,a.images[a.index]])}):f.apply(a.$target,[a,a.images[a.index]])}function f(b,c){if(b.loading=!0,b.tiled){b.tilesTotal=0,b.tilesLoaded=0;var d='<div class="zoomer-tiles">';for(var e in b.images[0])if(b.images[0].hasOwnProperty(e))for(var f in b.images[0][e])b.images[0][e].hasOwnProperty(f)&&(d+='<img class="zoomer-image zoomer-tile" src="'+b.images[0][e][f]+'" data-zoomer-tile="'+e+"-"+f+'" />',b.tilesTotal++);d+="</div>",b.$image=a(d),b.$tiles=b.$image.find("img"),b.$tiles.each(function(c,d){var e=a(d);e.one("load",b,g),e[0].complete&&e.trigger("load")})}else b.$image=a('<img class="zoomer-image" />'),b.$image.one("load.zoomer",b,h).attr("src",c),b.$image[0].complete&&b.$image.trigger("load")}function g(a){var b=a.data;b.tilesLoaded++,b.tilesLoaded===b.tilesTotal&&(b.tiledRows=b.images[0].length,b.tiledColumns=b.images[0][0].length,b.tiledHeight=b.$tiles.eq(0)[0].naturalHeight*b.tiledRows,b.tiledWidth=b.$tiles.eq(0)[0].naturalWidth*b.tiledColumns,h({data:b}))}function h(b){var c=b.data;c.tiled?(c.naturalHeight=c.tiledHeight,c.naturalWidth=c.tiledWidth):(c.naturalHeight=c.$image[0].naturalHeight,c.naturalWidth=c.$image[0].naturalWidth),c.retina&&(c.naturalHeight/=2,c.naturalWidth/=2),c.targetImageHeight=c.naturalHeight,c.targetImageWidth=c.naturalWidth,c.maxHeight=c.naturalHeight,c.maxWidth=c.naturalWidth,c.imageRatioWide=c.naturalWidth/c.naturalHeight,c.imageRatioTall=c.naturalHeight/c.naturalWidth,(c.naturalHeight>c.frameHeight-c.marginReal||c.naturalWidth>c.frameWidth-c.marginReal)&&(c=i(c),c.targetImageHeight=c.minHeight,c.targetImageWidth=c.minWidth),c.positionerLeft=c.targetPositionerLeft=c.centerLeft,c.positionerTop=c.targetPositionerTop=c.centerTop,c.imageLeft=c.targetImageLeft=Math.round(-c.targetImageWidth/2),c.imageTop=c.targetImageTop=Math.round(-c.targetImageHeight/2),c.imageHeight=c.targetImageHeight,c.imageWidth=c.targetImageWidth,c.$positioner.css({left:c.positionerLeft,top:c.positionerTop}),c.$holder.css({left:c.imageLeft,top:c.imageTop,height:c.imageHeight,width:c.imageWidth}).append(c.$image),c.tiled&&(c.$holder.css({background:"url("+c.tiledThumbnail+") no-repeat left top",backgroundSize:"100% 100%"}),c.tileHeightPercentage=100/c.tiledRows,c.tileWidthPercentage=100/c.tiledColumns,c.$tiles.css({height:c.tileHeightPercentage+"%",width:c.tileWidthPercentage+"%"}),c.$tiles.each(function(b,d){var e=a(d),f=e.data("zoomer-tile").split("-");e.css({left:c.tileWidthPercentage*parseInt(f[1],10)+"%",top:c.tileHeightPercentage*parseInt(f[0],10)+"%"})})),c.$holder.animate({opacity:1},300),c.loading=!1}function i(a){return a.naturalHeight>a.naturalWidth?(a.aspect="tall",a.minHeight=Math.round(a.frameHeight-a.marginReal),a.minWidth=Math.round(a.minHeight/a.imageRatioTall),a.minWidth>a.frameWidth-a.marginReal&&(a.minWidth=Math.round(a.frameWidth-a.marginReal),a.minHeight=Math.round(a.minWidth/a.imageRatioWide))):(a.aspect="wide",a.minWidth=Math.round(a.frameWidth-a.marginReal),a.minHeight=Math.round(a.minWidth/a.imageRatioWide),a.minHeight>a.frameHeight-a.marginReal&&(a.minHeight=Math.round(a.frameHeight-a.marginReal),a.minWidth=Math.round(a.minHeight/a.imageRatioTall))),a}function j(){for(var a=0,b=D.length;b>a;a++){var c=D.eq(a).data("zoomer");"object"==typeof c&&(c=k(c),c.lastAction=c.action,c.$positioner.css({left:c.positionerLeft,top:c.positionerTop}),c.$holder.css({left:c.imageLeft,top:c.imageTop,width:c.imageWidth,height:c.imageHeight}),c.callback&&c.callback.apply(c.$zoomer,[(c.imageWidth-c.minWidth)/(c.maxWidth-c.minWidth)]))}}function k(a){if("zoom_in"===a.action||"zoom_out"===a.action){a.keyDownTime+=a.increment;var b=("zoom_out"===a.action?-1:1)*Math.round(a.imageWidth*a.keyDownTime-a.imageWidth);"tall"===a.aspect?(a.targetImageHeight+=b,a.targetImageWidth=Math.round(a.targetImageHeight/a.imageRatioTall)):(a.targetImageWidth+=b,a.targetImageHeight=Math.round(a.targetImageWidth/a.imageRatioWide))}return"tall"===a.aspect?a.targetImageHeight<a.minHeight?(a.targetImageHeight=a.minHeight,a.targetImageWidth=Math.round(a.targetImageHeight/a.imageRatioTall)):a.targetImageHeight>a.maxHeight&&(a.targetImageHeight=a.maxHeight,a.targetImageWidth=Math.round(a.targetImageHeight/a.imageRatioTall)):a.targetImageWidth<a.minWidth?(a.targetImageWidth=a.minWidth,a.targetImageHeight=Math.round(a.targetImageWidth/a.imageRatioWide)):a.targetImageWidth>a.maxWidth&&(a.targetImageWidth=a.maxWidth,a.targetImageHeight=Math.round(a.targetImageWidth/a.imageRatioWide)),a.targetImageLeft=Math.round(.5*-a.targetImageWidth),a.targetImageTop=Math.round(.5*-a.targetImageHeight),a.imageWidth+=Math.round((a.targetImageWidth-a.imageWidth)*a.enertia),a.imageHeight+=Math.round((a.targetImageHeight-a.imageHeight)*a.enertia),a.imageLeft+=Math.round((a.targetImageLeft-a.imageLeft)*a.enertia),a.imageTop+=Math.round((a.targetImageTop-a.imageTop)*a.enertia),a.boundsLeft=Math.round(a.frameWidth-.5*a.targetImageWidth-a.marginMax),a.boundsRight=Math.round(.5*a.targetImageWidth+a.marginMax),a.boundsTop=Math.round(a.frameHeight-.5*a.targetImageHeight-a.marginMax),a.boundsBottom=Math.round(.5*a.targetImageHeight+a.marginMax),a.targetPositionerLeft<a.boundsLeft&&(a.targetPositionerLeft=a.boundsLeft),a.targetPositionerLeft>a.boundsRight&&(a.targetPositionerLeft=a.boundsRight),a.targetPositionerTop<a.boundsTop&&(a.targetPositionerTop=a.boundsTop),a.targetPositionerTop>a.boundsBottom&&(a.targetPositionerTop=a.boundsBottom),a.zoomPositionTop>0&&a.zoomPositionLeft>0&&(a.targetPositionerLeft=a.centerLeft-a.targetImageLeft-a.targetImageWidth*a.zoomPositionLeft,a.targetPositionerTop=a.centerTop-a.targetImageTop-a.targetImageHeight*a.zoomPositionTop),a.targetImageWidth<a.frameWidth&&(a.targetPositionerLeft=a.centerLeft),a.targetImageHeight<a.frameHeight&&(a.targetPositionerTop=a.centerTop),a.positionerLeft+=Math.round((a.targetPositionerLeft-a.positionerLeft)*a.enertia),a.positionerTop+=Math.round((a.targetPositionerTop-a.positionerTop)*a.enertia),a.oldImageWidth=a.imageWidth,a.oldImageHeight=a.imageHeight,a}function l(a){var b=a.data;!b.loading&&b.index+1<b.images.length&&(b.index++,e.apply(b.$target,[b]))}function m(a){var b=a.data;!b.loading&&b.index-1>=0&&(b.index--,e.apply(b.$target,[b]))}function n(a){a.preventDefault(),a.stopPropagation();var b=a.data;b=q(b),b.keyDownTime=1,b.action="zoom_in"}function o(a){a.preventDefault(),a.stopPropagation();var b=a.data;b=q(b),b.keyDownTime=1,b.action="zoom_out"}function p(a){a.preventDefault(),a.stopPropagation();var b=a.data;b=r(b),b.keyDownTime=0,b.action=""}function q(a,b,c){return b=b||.5*a.imageWidth,c=c||.5*a.imageHeight,a.zoomPositionLeft=(b-(a.positionerLeft-a.centerLeft))/a.imageWidth,a.zoomPositionTop=(c-(a.positionerTop-a.centerTop))/a.imageHeight,a}function r(a){return a.zoomPositionTop=0,a.zoomPositionLeft=0,a}function s(c){c.preventDefault&&(c.preventDefault(),c.stopPropagation());var d=c.data;d.action="drag",d.mouseX=c.pageX,d.mouseY=c.pageY,d.targetPositionerLeft=d.positionerLeft,d.targetPositionerTop=d.positionerTop,a(b).on("mousemove.zoomer",d,t).on("mouseup.zoomer",d,u)}function t(a){a.preventDefault&&(a.preventDefault(),a.stopPropagation());var b=a.data;a.pageX&&a.pageY&&(b.targetPositionerLeft-=Math.round(b.mouseX-a.pageX),b.targetPositionerTop-=Math.round(b.mouseY-a.pageY),b.mouseX=a.pageX,b.mouseY=a.pageY)}function u(c){c.preventDefault&&(c.preventDefault(),c.stopPropagation());var d=c.data;d.action="",a(b).off("mousemove.zoomer mouseup.zoomer")}function v(b){if(!(a(b.target).parent(".zoomer-controls").length>0)){b.preventManipulation&&b.preventManipulation(),b.preventDefault(),b.stopPropagation();var c=b.data,d=b.originalEvent;if(d.type.match(/(up|end)$/i))return void y(c,d);if(d.pointerId){var e=!1;for(var f in c.touches)c.touches[f].identifier===d.pointerId&&(e=!0,c.touches[f].pageX=d.clientX,c.touches[f].pageY=d.clientY);e||c.touches.push({identifier:d.pointerId,pageX:d.clientX,pageY:d.clientY})}else c.touches=d.touches;d.type.match(/(down|start)$/i)?w(c):d.type.match(/move$/i)&&x(c)}}function w(c){c.touchEventsBound||(c.touchEventsBound=!0,a(b).on("touchmove.zoomer MSPointerMove.zoomer",c,v).on("touchend.zoomer MSPointerUp.zoomer",c,v)),c.zoomPercentage=1,c.touches.length>=2&&(c.offset=c.$zoomer.offset(),c.pinchStartX0=c.touches[0].pageX-c.offset.left,c.pinchStartY0=c.touches[0].pageY-c.offset.top,c.pinchStartX1=c.touches[1].pageX-c.offset.left,c.pinchStartY1=c.touches[1].pageY-c.offset.top,c.pinchStartX=(c.pinchStartX0+c.pinchStartX1)/2,c.pinchStartY=(c.pinchStartY0+c.pinchStartY1)/2,c.imageWidthStart=c.imageWidth,c.imageHeightStart=c.imageHeight,q(c),c.pinchDeltaStart=Math.sqrt(Math.pow(c.pinchStartX1-c.pinchStartX0,2)+Math.pow(c.pinchStartY1-c.pinchStartY0,2))),c.mouseX=c.touches[0].pageX,c.mouseY=c.touches[0].pageY}function x(a){1===a.touches.length?(a.action="drag",a.targetPositionerLeft-=a.mouseX-a.touches[0].pageX,a.targetPositionerTop-=a.mouseY-a.touches[0].pageY):a.touches.length>=2&&(a.action="pinch",a.pinchEndX0=a.touches[0].pageX-a.offset.left,a.pinchEndY0=a.touches[0].pageY-a.offset.top,a.pinchEndX1=a.touches[1].pageX-a.offset.left,a.pinchEndY1=a.touches[1].pageY-a.offset.top,(a.pinchEndX0!==a.lastPinchEndX0||a.pinchEndY0!==a.lastPinchEndY0||a.pinchEndX1!==a.lastPinchEndX1||a.pinchEndY1!==a.lastPinchEndY1)&&(a.pinchDeltaEnd=Math.sqrt(Math.pow(a.pinchEndX1-a.pinchEndX0,2)+Math.pow(a.pinchEndY1-a.pinchEndY0,2)),a.zoomPercentage=a.pinchDeltaEnd/a.pinchDeltaStart,a.targetImageWidth=Math.round(a.imageWidthStart*a.zoomPercentage),a.targetImageHeight=Math.round(a.imageHeightStart*a.zoomPercentage),a.pinchEndX=(a.pinchEndX0+a.pinchEndX1)/2,a.pinchEndY=(a.pinchEndY0+a.pinchEndY1)/2,a.lastPinchEndX0=a.pinchEndX0,a.lastPinchEndY0=a.pinchEndY0,a.lastPinchEndX1=a.pinchEndX1,a.lastPinchEndY1=a.pinchEndY1)),a.mouseX=a.touches[0].pageX,a.mouseY=a.touches[0].pageY}function y(c,d){if(c.action="",c.lastPinchEndX0=c.pinchEndX0=c.pinchStartX0=0,c.lastPinchEndY0=c.pinchEndY0=c.pinchStartY0=0,c.lastPinchEndX1=c.pinchEndX1=c.pinchStartX1=0,c.lastPinchEndY1=c.pinchEndY1=c.pinchStartY1=0,c.pinchStartX=c.pinchEndX=0,c.pinchStartY=c.pinchEndX=0,r(c),d.pointerId)for(var e in c.touches)c.touches[e].identifier===d.pointerId&&c.touches.splice(e,1);c.touches.length<=1?(a(b).off(".zoomer"),c.touchEventsBound=!1):(c.mouseX=c.touches[0].pageX,c.mouseY=c.touches[0].pageY)}function z(a){return a.tiled=!1,a.gallery=!1,"string"==typeof a.source?a.images=[a.source]:"string"==typeof a.source[0]?(a.images=a.source,a.images.length>1&&(a.gallery=!0)):(a.tiledThumbnail=a.source.thumbnail,a.images=[a.source.tiles],a.tiled=!0),a}function A(){E||(E=!0,C())}function B(){E=!1}function C(){E&&(b.requestAnimationFrame(C),j())}var D,E=!1,F={callback:a.noop,controls:{position:"bottom",zoomIn:null,zoomOut:null,next:null,previous:null},customClass:"",enertia:.2,increment:.01,marginMin:30,marginMax:100,retina:!1,source:null},G={images:[],aspect:"",action:"",lastAction:"",keyDownTime:0,marginReal:0,originalDOM:"",gallery:!1,index:0,$tiles:null,tiled:!1,tilesTotal:0,tilesLoaded:0,tiledColumns:0,tiledRows:0,tiledHeight:0,tiledWidth:0,tiledThumbnail:null,centerLeft:0,centerTop:0,frameHeight:0,frameWidth:0,naturalHeight:0,naturalWidth:0,imageRatioWide:0,imageRatioTall:0,minHeight:null,minWidth:null,maxHeight:0,maxWidth:0,boundsTop:0,boundsBottom:0,boundsLeft:0,boundsRight:0,imageWidth:0,imageHeight:0,imageLeft:0,imageTop:0,targetImageWidth:0,targetImageHeight:0,targetImageLeft:0,targetImageTop:0,oldImageWidth:0,oldImageHeight:0,positionerLeft:0,positionerTop:0,targetPositionerLeft:0,targetPositionerTop:0,zoomPositionLeft:0,zoomPositionTop:0,offset:null,touches:[],zoomPercentage:1,pinchStartX0:0,pinchStartX1:0,pinchStartY0:0,pinchStartY1:0,pinchEndX0:0,pinchEndX1:0,pinchEndY0:0,pinchEndY1:0,lastPinchEndX0:0,lastPinchEndY0:0,lastPinchEndX1:0,lastPinchEndY1:0,pinchDeltaStart:0,pinchDeltaEnd:0},H={defaults:function(b){return F=a.extend(F,b||{}),a(this)},destroy:function(){var c=a(this).each(function(c,d){var e=a(d).data("zoomer");e&&(a(b).off(".zoomer"),e.$holder.off(".zoomer"),e.$zoomer.off(".zoomer"),e.controls.$zoomIn.off(".zoomer"),e.controls.$zoomOut.off(".zoomer"),e.controls.$next.off(".zoomer"),e.controls.$previous.off(".zoomer"),e.$target.removeClass("zoomer-element").data("zoomer",null).empty().append(e.originalDOM))});return D=a(".zoomer-element"),D.length<1&&B(),c},load:function(b){return a(this).each(function(c,d){var f=a(d).data("zoomer");f&&(f.source=b,f.index=0,f=z(f),e(f))})},pan:function(b,c){return a(this).each(function(d,e){var f=a(e).data("zoomer");f&&(b/=100,c/=100,f.targetPositionerLeft=Math.round(f.centerLeft-f.targetImageLeft-f.targetImageWidth*b),f.targetPositionerTop=Math.round(f.centerTop-f.targetImageTop-f.targetImageHeight*c))})},resize:function(){return a(this).each(function(b,c){var d=a(c).data("zoomer");d&&(d.frameWidth=d.$target.outerWidth(),d.frameHeight=d.$target.outerHeight(),d.centerLeft=Math.round(.5*d.frameWidth),d.centerTop=Math.round(.5*d.frameHeight),d=i(d))})},unload:function(){return a(this).each(function(){var b=a(this).data("zoomer");b&&"undefined"!=typeof b.$image&&b.$image.remove()})}};a.fn.zoomer=function(a){return H[a]?H[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?this:c.apply(this,arguments)},a.zoomer=function(a){"defaults"===a&&H.defaults.apply(this,Array.prototype.slice.call(arguments,1))}}(jQuery,window);